# Reglas de comportamiento automatizado para Cursor

## Verificación de sintaxis y tests

Siempre que realices cambios en el código de la solución debes:

1. **Verificar errores de sintaxis**: Antes de finalizar cualquier tarea, verifica que no haya errores de sintaxis en los archivos modificados usando las herramientas de linting apropiadas.

2. **Ejecutar tests automáticamente**: 
   - Para proyectos TypeScript/JavaScript (directorio `Cliente/`): Ejecuta automáticamente `npm test` en el directorio `Cliente/`.
   - Para proyectos .NET/C# (directorios `Api/`, `GesFer.Console/`, `TempHash/`): Ejecuta automáticamente `dotnet test` en el directorio correspondiente.

3. **Informar resultados de tests**: Antes de dar por finalizada cualquier tarea que implique cambios en el código, DEBES:
   - Ejecutar los tests correspondientes según el tipo de proyecto modificado.
   - Informar explícitamente del resultado de los tests (éxito o fallos).
   - Si hay fallos en los tests, investigar y corregir los problemas antes de considerar la tarea como completada.
   - Solo después de confirmar que los tests pasan (o que los fallos existentes no están relacionados con los cambios), puedes dar por finalizada la tarea.

4. **Convenciones de nombres**:
   - **C# (.cs)**: Usar PascalCase para clases, métodos, propiedades, namespaces, interfaces y otros identificadores públicos.
     - Ejemplo: `MiClase`, `MetodoEjemplo()`, `PropiedadPublica`
   - **TypeScript/JavaScript (.ts, .tsx, .js, .jsx)**: Usar camelCase para variables, funciones, métodos y propiedades.
     - Ejemplo: `miVariable`, `miFuncion()`, `miPropiedad`
   - Respetar estas convenciones en todo el código nuevo y al refactorizar código existente.

## Regla de Oro: Sincronización de Entidades, Seeds y Tests

**Siempre que se cree, modifique o elimine una propiedad en cualquier entidad del proyecto (C#), debes realizar de forma atómica las siguientes acciones:**

1. **Sincronización de Seeds**: 
   - Actualiza la lógica de `SetupService.SeedInitialDataAsync()` para incluir valores coherentes para las nuevas propiedades.
   - Actualiza `MasterDataSeeder.cs` si la propiedad afecta a datos maestros.
   - Actualiza `seed-data.sql` si se usa para seeding.
   - Si la propiedad es requerida, asegúrate de que el dato de ejemplo sea válido.

2. **Sincronización de Tests**:
   - Localiza los Data Builders o Object Factories en el proyecto de Testing y actualízalos para reflejar el cambio en la entidad.
   - Actualiza `TestDataSeeder.cs` en `IntegrationTests/Helpers/` para incluir la nueva propiedad con valores válidos.
   - Si hay tests unitarios o de integración que fallen debido al cambio de firma o estructura, corrígelos inmediatamente.

3. **Integridad Referencial**: 
   - Si el cambio implica una nueva relación (Foreign Key), asegúrate de que el seeding respete el orden de inserción.
   - Asegúrate de que los tests usen los Sequential GUIDs generados por nuestro sistema cuando sea necesario.

4. **Verificación**: 
   - Al finalizar, propón el comando de terminal para ejecutar los tests (`dotnet test`) y confirma que el seeding no produce errores de validación.
   - No consideres la tarea de modificación de la entidad como terminada hasta que los Seeds y los Tests estén alineados.

## Regla Global: Validación Automática de Integridad (Modo Omnisciente)

**Cualquier modificación en la carpeta `/Cliente` (Next.js) o `/Api` (C#) dispara el mismo protocolo de seguridad:**

1. **Detección Automática de Cambios**:
   - Si cambias el Cliente (Next.js): Cursor debe ejecutar la consola de validación para asegurar que los cambios no rompieron la comunicación con la API.
   - Si cambias la API (C#): Cursor debe ejecutar la consola de validación para asegurar que el Cliente sigue pudiendo autenticarse y consumir los datos.

2. **Protocolo de Validación**:
   - Ejecutar automáticamente: `dotnet run --project GesFer.Console/GesFer.Console.csproj` y seleccionar la opción "2. Validación de integridad completa"
   - O ejecutar directamente: `GesFer.Console\bin\Debug\net8.0\GesFer.Console.exe` con argumento de validación (si se implementa)
   - La consola validará:
     - **Docker**: Contenedores (DB, API, Adminer) están Running
     - **Backend**: API responde en puerto 5000/5001 y Sequential GUIDs funcionan
     - **Cliente**: Next.js responde en puerto 3000 y no hay errores de compilación visibles

3. **Gestión de Errores Cruzada**:
   - Si la consola detecta un error en el cliente (ej. un 404 en una ruta de Next.js o un error de tipos en el fetch):
     - Cursor debe leer ese error del log de la consola
     - Buscar el componente de React/Next.js afectado
     - Proponer la solución automáticamente
   - Si la consola detecta un error en la API (ej. endpoint no responde o Sequential GUIDs fallan):
     - Cursor debe leer ese error del log
     - Buscar el controlador/servicio afectado en C#
     - Proponer la solución automáticamente

4. **Instrucción de Cierre**:
   - **NO des por cerrada ninguna tarea de UI o de Lógica de Negocio hasta que:**
     - La consola de integridad marque 'TODO VERDE'
     - Las ventanas del navegador se desplieguen sin errores
     - Todos los checks (Docker, Backend, Cliente, Sequential GUIDs) estén en verde

5. **Ejecución Automática**:
   - Después de cualquier cambio significativo en `/Cliente` o `/Api`, Cursor debe:
     - Compilar el proyecto de consola si es necesario
     - Ejecutar la validación de integridad
     - Reportar el resultado
     - Si hay errores, detener y corregir antes de continuar

## Flujo de trabajo recomendado

1. Realizar los cambios de código solicitados.
2. **Si se modificó una entidad**: Aplicar la Regla de Oro (sincronizar Seeds y Tests).
3. **Si se modificó `/Cliente` o `/Api`**: Ejecutar validación de integridad automática.
4. Verificar errores de sintaxis con linters.
5. Ejecutar los tests apropiados (`npm test` o `dotnet test`).
6. Revisar y reportar los resultados de los tests.
7. Si hay fallos relacionados con los cambios, corregirlos y repetir desde el paso 3.
8. **Solo después de que la consola marque 'TODO VERDE' y las ventanas del navegador se desplieguen sin errores**, informar que la tarea está finalizada.
